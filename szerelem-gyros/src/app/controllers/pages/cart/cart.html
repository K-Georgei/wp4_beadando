<div class="container mt-4">
  @if (cartService.cartItems().length > 0) {
    <mat-card>
      <mat-card-header>
        <mat-card-title>Kosár tartalma</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="cartService.cartItems()" class="mat-elevation-z8 w-100">

          <!-- Product Column -->
          <ng-container matColumnDef="product">
            <th mat-header-cell *matHeaderCellDef> Termék </th>
            <td mat-cell *matCellDef="let item"> {{item.product.title}} </td>
          </ng-container>

          <!-- Price Column -->
          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef> Ár </th>
            <td mat-cell *matCellDef="let item"> {{item.product.price | number:'1.0-0'}} Ft </td>
          </ng-container>

          <!-- Quantity Column -->
          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef> Mennyiség </th>
            <td mat-cell *matCellDef="let item">
              <mat-form-field class="quantity-input">
                <input matInput type="number" [value]="item.quantity" min="1" (change)="onQuantityChange(item.product.id!, $event)">
              </mat-form-field>
            </td>
          </ng-container>

          <!-- Subtotal Column -->
          <ng-container matColumnDef="subtotal">
            <th mat-header-cell *matHeaderCellDef> Részösszeg </th>
            <td mat-cell *matCellDef="let item"> {{(item.product.price! * item.quantity) | number:'1.0-0'}} Ft </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let item">
              <button mat-icon-button color="warn" (click)="onRemove(item.product.id!)">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <div class="text-end fs-4 fw-bold mt-3">
          Végösszeg: {{ cartService.totalPrice() | number:'1.0-0' }} Ft
        </div>
      </mat-card-content>
    </mat-card>

    <div class="d-flex justify-content-end gap-2 mt-4">
      <button mat-stroked-button color="warn" (click)="onClearCart()">Kosár ürítése</button>
      <button mat-raised-button color="primary" routerLink="/payform" [disabled]="cartService.cartItems().length === 0">
        Tovább a fizetéshez
      </button>
    </div>

  } @else {
    <div class="text-center p-5">
      <h2>A kosarad üres.</h2>
      <p>Böngéssz a menüben és tedd kosárba a kedvenceidet!</p>
      <button mat-raised-button color="primary" routerLink="/">Vissza a menühöz</button>
    </div>
  }
</div>
